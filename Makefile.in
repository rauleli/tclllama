# Makefile.in for tclllama - Tcl extension using TEA
#
# This Makefile is generated by configure from Makefile.in
#

# Variables set by configure
srcdir = @srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@
libdir = @libdir@
bindir = @bindir@
TCL_VERSION = @TCL_VERSION@
TCL_BIN_DIR = @TCL_BIN_DIR@
TCL_SRC_DIR = @TCL_SRC_DIR@
TCL_LIB_SPEC = @TCL_LIB_SPEC@
TCL_STUB_LIB_SPEC = @TCL_STUB_LIB_SPEC@
TCL_INCLUDE_SPEC = @TCL_INCLUDE_SPEC@
TCL_SHLIB_SUFFIX = @TCL_SHLIB_SUFFIX@
LLAMA_INCLUDES = @LLAMA_INCLUDES@
LLAMA_LIBS = @LLAMA_LIBS@
CFLAGS = @CFLAGS@
CPPFLAGS = @CPPFLAGS@
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@
CC = @CC@
CXX = @CXX@
SHLIB_LD = @SHLIB_LD@
SHLIB_LD_LIBS = @SHLIB_LD_LIBS@
LD_LIBRARY_PATH_VAR = @LD_LIBRARY_PATH_VAR@
LD = @LD@

# Extension name and version
PACKAGE = tclllama
VERSION = 1.0

# Build directory
OBJDIR = .
TARGET_DIR = $(libdir)

# Source and object files
SOURCES = generic/tclllama.c generic/sha256.c
OBJS = $(OBJDIR)/tclllama.o $(OBJDIR)/sha256.o

# Shared library name
SHLIB = tclllama$(TCL_SHLIB_SUFFIX)

# Compiler flags
COMPILE_FLAGS = $(CFLAGS) $(CPPFLAGS) $(TCL_INCLUDE_SPEC) $(LLAMA_INCLUDES) -fPIC

# Linker flags
LINK_FLAGS = $(LDFLAGS) $(TCL_LIB_SPEC) $(LIBS) $(LLAMA_LIBS) -lcrypto

# Default target
all: $(SHLIB)

# Link the shared library
$(SHLIB): $(OBJS)
	$(SHLIB_LD) -o $@ $(OBJS) $(LINK_FLAGS)

# Compile tclllama.c
$(OBJDIR)/tclllama.o: generic/tclllama.c
	$(CC) $(COMPILE_FLAGS) -c generic/tclllama.c -o $@

# Compile sha256.c
$(OBJDIR)/sha256.o: generic/sha256.c
	$(CC) $(COMPILE_FLAGS) -c generic/sha256.c -o $@

# Installation
install: $(SHLIB)
	mkdir -p $(TARGET_DIR)
	cp $(SHLIB) $(TARGET_DIR)/
	cp library/*.tcl $(TARGET_DIR)/ || true

# Clean
clean:
	rm -f $(OBJS) $(SHLIB)

# Distclean
distclean: clean
	rm -f Makefile config.status config.log config.cache

# Help
help:
	@echo "$(PACKAGE) $(VERSION)"
	@echo "Targets:"
	@echo "  all    - Build the extension library"
	@echo "  install - Install the extension"
	@echo "  clean   - Remove built files"
	@echo "  distclean - Remove all generated files"

.PHONY: all install clean distclean help
